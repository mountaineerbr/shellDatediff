<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Jamil Soni N" />
  <title>DATEDIFF.SH(1) v0.27 | General Commands Manual</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">DATEDIFF.SH(1) v0.27 | General Commands Manual</h1>
<p class="author">Jamil Soni N</p>
<p class="date">June 2025</p>
</header>
<h1 id="name">NAME</h1>
<div class="line-block">   <strong>datediff.sh</strong> - Calculate time
ranges / intervals between dates</div>
<h1 id="synopsis">SYNOPSIS</h1>
<div class="line-block">   <strong>datediff.sh</strong> [-Rrttuvvv]
[-<em>NUM</em>] [-f <em>"FMT"</em>] <em>DATE1</em> <em>DATE2</em>
[<em>UNIT</em>]<br />
   <strong>datediff.sh</strong> <strong>-FF</strong> [-vv]
[[<em>DAY_IN_WEEK</em>] [<em>DAY_IN_MONTH</em>]]
[<em>START_DATE</em>]<br />
   <strong>datediff.sh</strong>
[<strong>-ee</strong>|<strong>-l</strong>] [-v] <em>YEAR</em>..<br />
   <strong>datediff.sh</strong> <strong>-m</strong> [-v]
<em>DATE</em>..</div>
<h1 id="description">DESCRIPTION</h1>
<p>Calculate time interval (elapsed time) between <em>DATE1</em> and
<em>DATE2</em> in various time units.</p>
<p>For robust parsing of diverse date formats beyond ISO-8601 and UNIX
times, <code>datediff.sh</code> can leverage an external
<code>C-code date</code> utility (e.g., <code>GNU date</code>,
<code>BSD date</code>).</p>
<p>Special functions include checking for leap years, generating dates
for Easter, Carnaval, and Corpus Christi, and calculating the phase of
the moon for a specified date.</p>
<h1 id="options">OPTIONS</h1>
<h2 id="date-and-time-calculations">Date and Time Calculations</h2>
<dl>
<dt><strong>-[<strong><em>0-9</em></strong>]</strong>,
<strong>-[<strong><em>NUM</em></strong>]</strong></dt>
<dd>
<p>Scale factor (decimal plates) for single time-unit float results.</p>
<p>Parameter <em>NUM</em> must be an integer.</p>
</dd>
<dt><strong>-f</strong> [<em>FMT</em>]</dt>
<dd>
<p>Input time format specification (<code>BSD date</code>).</p>
</dd>
<dt><strong>-R</strong></dt>
<dd>
<p>Print output dates in RFC-5322 format.</p>
</dd>
<dt><strong>-r</strong>, <strong>-@</strong></dt>
<dd>
<p>Input DATES are UNIX timestamps.</p>
</dd>
<dt><strong>-t</strong>, <strong>-tt</strong></dt>
<dd>
<p>Table display layout selection of single-unit intervals.</p>
</dd>
<dt><strong>-u</strong></dt>
<dd>
<p>Set input and output dates to UTC instead of local times.</p>
<p>This affects how <code>C-code date</code> processes input dates.</p>
</dd>
<dt><strong>-v</strong>, <strong>-vv</strong>,
<strong>-vvv</strong></dt>
<dd>
<p>Select / filter output result groups (main function).</p>
<p>Verbosity levels.</p>
</dd>
</dl>
<h2 id="special-date-functions">Special Date Functions</h2>
<dl>
<dt><strong>-e</strong> [<em>YEAR</em>..]</dt>
<dd>
<p>Easter dates (Western Church).</p>
</dd>
<dt><strong>-ee</strong> [<em>YEAR</em>..]</dt>
<dd>
<p>Carnaval, Easter and Corpus Christi dates (table in TSV format).</p>
</dd>
<dt><strong>-F</strong>, <strong>-FF</strong> [[<em>DAY_IN_WEEK</em>]
[<em>DAY_IN_MONTH</em>]] [<em>START_DATE</em>]</dt>
<dd>
<p>Following Friday the 13th date.</p>
<p>Set twice to print the following 10 matches.</p>
</dd>
<dt><strong>-h</strong></dt>
<dd>
<p>Print the script help page.</p>
</dd>
<dt><strong>-l</strong> [<em>YEAR</em>..]</dt>
<dd>
<p>Check for leap years.</p>
</dd>
<dt><strong>-m</strong> [<em>YYYY[-MM[-DD]]</em>]</dt>
<dd>
<p>Print lunar phase for DATE.</p>
</dd>
</dl>
<h1 id="date-and-time-calculations-1">DATE AND TIME CALCULATIONS</h1>
<p><code>GNU date</code> accepts mostly free format human readable date
strings. If using <code>FreeBSD date</code>, input <em>DATE</em> strings
must be <strong>ISO-8601</strong> (“<em>YYYY-MM-DDThh:mm:ss</em>”) or
other supported time formats, unless <strong>option -f</strong>
<em>FMT</em> is set to a new input time format. If
<code>C-code date</code> programme is not available, then input must be
formatted as <strong>ISO-8601</strong> or <strong>UNIX
time</strong>.</p>
<p>If <em>DATE</em> is not set, defaults to <em>now</em>. If only one
<em>DATE</em> is set, the first one is assumed to be <em>now</em> (or
<em>1970</em> as last fallback).</p>
<p>To flag <em>DATE</em> as UNIX time, prepend an “at” sign “<em>@</em>”
to it or set <strong>option -r</strong>.</p>
<p>Stdin input is expected to have one <em>DATE</em> string per line
(max two lines) or two ISO-8601 <em>DATES</em> separated by space in a
single line. Input is processed in a best-effort basis.</p>
<h1 id="date-and-time-output">DATE AND TIME OUTPUT</h1>
<p>Output “RANGES” section displays intervals in different units of time
(years, or months, or weeks, or days, or hours, or minutes, or seconds
alone). It also displays a compound time range, considering all units
relative to each other.</p>
<p>Single <em>UNIT</em> time periods can be displayed in table format
with <strong>option -t</strong>. The decimal scale factor can be set
with command line <strong>option -NUM</strong> where <em>NUM</em> is an
integer. The least significant digit of the result is subject to
rounding.</p>
<p>When the last positional parameter <em>UNIT</em> is exactly one of
<em>Y</em>, <em>MO</em>, <em>W</em>, <em>D</em>, <em>H</em>, <em>M</em>,
or <em>S</em>, only a single <em>UNIT</em> time interval is printed to
stdout.</p>
<p>Output “DATES” section prints input dates in <strong>ISO-8601
format</strong> or, if <strong>option -R</strong> is set,
<strong>RFC-5322 format</strong>.</p>
<p><strong>Option -u</strong> sets or prints dates in Coordinated
Universal Time (UTC). This affects how the <code>C-code date</code>
programme processes dates, too.</p>
<p>Set <strong>option -v</strong> to print only the single-unit results
and <strong>-vv</strong> to print only the compound time range
result.</p>
<!--
In other function, set **options -v** to decrease verbosity. -->
<h1 id="special-date-functions-1">SPECIAL DATE FUNCTIONS</h1>
<p><strong>Option -e</strong> prints Easter dates for given
<em>YEARS</em> (Western Church) and <strong>option -ee</strong>
additionally prints Carnaval and Corpus Christi dates.</p>
<p><strong>Option -l</strong> checks if <em>YEAR</em> is leap. Set
<strong>option -v</strong> to decrease verbosity. The ISO-8601 system
assumes proleptic Gregorian calendar, year zero, and no leap
seconds.</p>
<p><strong>Option -m</strong> prints lunar phase for <em>UTC</em>
<em>DATE</em> (“<em>YYYY[-MM[-DD]]</em>”). Auto expansion takes place on
partial <em>DATE input</em>. Code snippet adapted from
<em>NetHack</em>.</p>
<p><strong>Option -F</strong> prints the date of next Friday the 13th.
The <em>START_DATE</em> must be formatted as “<em>YYYY[-MM[-DD]]</em>”.
Optionally, set <em>day-in-week</em>, such as <em>Sunday</em>, and
<em>day-in-month</em> as the first and second positional parameters,
respectively. Set <strong>options -FF</strong> to print the following
ten matches.</p>
<h1 id="timezone-offsets">TIMEZONE OFFSETS</h1>
<p>Dates formatted in <strong>ISO-8601</strong> and <strong>POSIX
offset</strong> declaration in environment variable $TZ are features
supported throughout this script.</p>
<p>Environment $TZ is read as <strong>POSIX offset</strong> when it
holds a positive or negative decimal number, such as “<em>+03</em>” (or
even “<em>UTC+03</em>”). <strong>POSIX</strong> time zone definition by
the $TZ variable takes a different form from <strong>ISO-8601</strong>
standards, so that “<em>ISO</em> <em>UTC-03</em>” is equivalent to
setting “<em>$TZ=UTC+03</em>”.</p>
<p>Importantly, $TZ <strong>POSIX offsets</strong> are often the inverse
of <strong>ISO-8601</strong> <em>UTC</em> <em>values</em> seen in
timestamps, so that:</p>
<pre><code>  &quot;$TZ=+03&quot; corresponds to an offset of &quot;ISO UTC-03&quot; (West of UTC)

  &quot;$TZ=-03&quot; corresponds to an offset of &quot;ISO UTC+03&quot; (East of UTC)</code></pre>
<p>Timezone names and IDS (e.g. “<em>America/Sao_Paulo</em>”) may be
parsed by one <code>C-code date</code> programme when it is leveraged to
process user input.</p>
<h1 id="environment">ENVIRONMENT</h1>
<dl>
<dt><strong>DATE_CMD</strong></dt>
<dd>
<p>Path for the <code>C-code date</code> binary.</p>
<p><strong>GNU</strong>, <strong>BSD</strong>, <strong>AST</strong>, and
<strong>Busybox</strong> <strong>date</strong> are supported.</p>
</dd>
<dt><strong>TZ</strong></dt>
<dd>
<p><strong>POSIX</strong> time zone offset. Numeric offset must be in
the format “<em>[+|-]HH[:MM]</em>”, or sometimes
“<em>UTC[+|-]HH[:MM]</em>”.</p>
</dd>
</dl>
<!--  Better mentioned in Diagnostics
**CFACTOR**

:    Correction factor used in the lunar phase function.

     Default=\"_-1892_\"
-->
<h1 id="refinement-rules">REFINEMENT RULES</h1>
<p><strong>Compound time range</strong> calculations depend on refining
logic to assemble the final results when dealing with end-of-month and
start-of-month date combinations, and different month lengths.</p>
<p>The script’s compound time range calculations largely follow
Hroptatyr’s <code>C-code datediff</code> refinement rules.</p>
<p>Script error rate of the main code is estimated to be lower than one
percent after extensive testing with selected and corner-case sample
dates and times.</p>
<p>Check source code and project repository for details and
documentation.</p>
<h1 id="diagnostics">DIAGNOSTICS</h1>
<p><strong>Option -d</strong> executes result checks against
<code>C-code datediff</code> and <code>C-code date</code> programmes in
the main function. This sets UTC time and runs checks against
<code>C-code datediff</code> and <code>C-code date</code>.</p>
<p>Set <strong>options -dd</strong> to code exit immediately. Debug data
is dumped only when checks fail.</p>
<p><strong>Option -D</strong> disables external <code>C-code date</code>
for date input parsing.</p>
<p><strong>Option -DD</strong> disables all external date parsing
mechanisms, including <code>C-code date</code> and shell time-related
builtins.</p>
<p>Lunar phase function incorporates an internal empirical constant.
Environment variable <strong>$CFACTOR</strong> offers an override to
this value. Default is "-1892".</p>
<h1 id="dependencies">DEPENDENCIES</h1>
<p>This script uses shell arithmetics to perform most time range
calculations and relies on <code>bc</code> for large-number integers and
float arithmetics.</p>
<p>The Desk Calculator <code>dc</code> is executed in the Easter
function as a mysterious function taken from <em>Dershowitz and
Reingold</em>’s paper.</p>
<ul>
<li><code>Bash2.05b+</code>, <code>Ksh93</code> or <code>Zsh</code> is
required.</li>
<li>Basic Calculator <code>bc</code> or shell
<code>Ksh93</code>/<code>Zsh</code> is required for single-unit time
calculations.</li>
<li><code>FreeBSD12+ date</code> or <code>GNU date</code> is optionally
required to parse input date in various formats.</li>
<li>For debugging, <em>Hroptatyr</em>’s <code>C-code datediff</code>,
<code>C-code date</code>, and <code>datediff.debug.sh</code> are
needed.</li>
</ul>
<h1 id="examples">EXAMPLES</h1>
<p><strong>Leap year check</strong></p>
<div class="line-block">   datediff.sh <strong>-l</strong>
{1990..2000}<br />
   echo 2000 | datediff.sh <strong>-l</strong></div>
<p><strong>Moon phases for January or full year</strong></p>
<div class="line-block">   datediff.sh <strong>-m</strong> 1996-01<br />
   datediff.sh <strong>-m</strong> 1996</div>
<p><strong>Print following Friday, 13th</strong></p>
<div class="line-block">   datediff.sh <strong>-F</strong></div>
<p><strong>Print following Sunday, 12th after 1999</strong></p>
<div class="line-block">   datediff.sh <strong>-F</strong> sun 12
1999</div>
<p><strong>Single-unit time periods</strong></p>
<div class="line-block">   datediff.sh '10 years ago' <em>mo</em>
#[mo]nths<br />
   datediff.sh 1970-01-01 2000-02-02 <em>y</em> #[y]ears</div>
<p><strong>Time ranges/intervals</strong></p>
<div class="line-block">   datediff.sh 0921-04-12 1999-01-31<br />
   echo 1970-01-01 2000-02-02 | datediff.sh<br />
   <strong>TZ=UTC+03</strong> datediff.sh 2020-01-03T14:30:10-06
2021-12-30T21:00:10-03</div>
<p><strong>GNU date warping</strong></p>
<div class="line-block">   datediff.sh 2019/6/28 1Aug<br />
   datediff.sh 'next monday'<br />
   datediff.sh '5min 34seconds'<br />
   datediff.sh '2020-01-01 - 6months' '2020-01-01'<br />
   datediff.sh '05 jan 2005' 'now - 43years -13 days'<br />
   datediff.sh <strong>-2</strong> -- '1hour ago 30min ago'<br />
   datediff.sh <strong>-u</strong> '2023-01-14T11:20:00Z'
'2023-01-14T11:20:00Z + 5 hours'<br />
   datediff.sh -- '-2week-3day' 'now'<br />
   datediff.sh -- 'today + 1day' <em>@</em>1952292365<br />
   datediff.sh <em>@</em>1561243015 <em>@</em>1592865415</div>
<p><strong>BSD date warping</strong></p>
<div class="line-block">   datediff.sh <strong>-f</strong>'%m/%d/%Y'
'6/28/2019' '9/04/1970'<br />
   datediff.sh <strong>-r</strong> 1561243015 1592865415<br />
   datediff.sh 200002280910.33 0003290010.00<br />
   datediff.sh -- '-v +2d' '-v -3w'</div>
<h1 id="warranty">WARRANTY</h1>
<p>Licensed under the <strong>GNU General Public License 3</strong> or
better. This software is distributed without support or bug
corrections.</p>
<p>Many thanks for all advice from c.u.shell!</p>
<h1 id="project-source">PROJECT SOURCE</h1>
<pre><code>&lt;https://gitlab.com/fenixdragao/shelldatediff&gt;

&lt;https://github.com/mountaineerbr/shellDatediff&gt;</code></pre>
<h1 id="see-also">SEE ALSO</h1>
<ul>
<li><p><code>Datediff</code> from <code>dateutils</code>, by
<em>Hroptatyr</em> &lt;www.fresse.org/dateutils/&gt;.</p></li>
<li><p><code>PDD</code> from <em>Jarun</em> <a
href="https://github.com/jarun/pdd"
class="uri">https://github.com/jarun/pdd</a>.</p></li>
<li><p><code>AST date</code> elapsed time <code>option -E</code> <a
href="https://github.com/att/ast"
class="uri">https://github.com/att/ast</a>.</p></li>
<li><p><code>Units</code> from GNU. <a
href="https://www.gnu.org/software/units/"
class="uri">https://www.gnu.org/software/units/</a>.</p></li>
<li><p>“<em>Do calendrical savants use calculation to answer date
questions?</em>” A functional magnetic resonance imaging study,
<em>Cowan and Frith</em>, 2009 <a
href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2677581/#!po=21.1864"
class="uri">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2677581/#!po=21.1864</a>.</p></li>
<li><p>Calendrical calculation, <em>Dershowitz and Reingold</em>, 1990
<a href="http://www.cs.tau.ac.il/~nachum/papers/cc-paper.pdf"
class="uri">http://www.cs.tau.ac.il/~nachum/papers/cc-paper.pdf</a> <a
href="https://books.google.com.br/books?id=DPbx0-qgXu0C"
class="uri">https://books.google.com.br/books?id=DPbx0-qgXu0C</a>.</p></li>
<li><p>How many days are in a year? <em>Manning</em>, 1997 <a
href="https://pumas.nasa.gov/files/04_21_97_1.pdf"
class="uri">https://pumas.nasa.gov/files/04_21_97_1.pdf</a>.</p></li>
<li><p>Iana Time zone database <a href="https://www.iana.org/time-zones"
class="uri">https://www.iana.org/time-zones</a>.</p></li>
<li><p>Fun with Date Arithmetic (see replies) <a
href="https://linuxcommando.blogspot.com/2009/11/fun-with-date-arithmetic.html"
class="uri">https://linuxcommando.blogspot.com/2009/11/fun-with-date-arithmetic.html</a>.</p></li>
</ul>
<!--
- "_Division is but subtractions and multiplication but additions_" \--Lost reference
-->
<!-- Generate the man page:
    pandoc --standalone --to man ./datediff.sh.1.md -o ./datediff.sh.1
-->
</body>
</html>
